# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Dashboard Maui
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# VersiÃ³n: 3.4 (Vista Simple de CÃ¡maras)
# Fecha: 15 de Diciembre, 2025
#
# CaracterÃ­sticas:
#   - Vista Home: CÃ¡maras simples, Escenas, Control de Presencia
#   - Vista Riego: Sistema de Riego Inteligente Zona 1
#   - EstÃ©tica: Minimalista, oscura, profesional
#
# Cambios en v3.4:
#   - Eliminado sistema de agrandamiento dinÃ¡mico de cÃ¡maras
#   - Vista simple de cÃ¡maras (no depende de detecciones)
#   - Limpieza de cÃ³digo condicional y helpers obsoletos
#
# Cambios en v3.3:
#   - Eliminada secciÃ³n de Frigate (desinstalado temporalmente)
#   - Limpieza de entidades no disponibles
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

title: Maui
views:
  - title: Principal
    path: home
    icon: mdi:home
    theme: maui_dark
    type: custom:grid-layout
    layout:
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr))
      grid-gap: 16px
    badges: []
    cards:
      - type: markdown
        content: |
          # CÃ¡maras
        view_layout:
          grid-column: 1 / -1
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-bottom: -12px;
            }
            h1 {
              font-size: 18px;
              font-weight: 400;
              margin: 0;
              padding: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }

      - type: picture-entity
        entity: camera.tapo_c530ws_entrada_live_view
        camera_view: live
        show_name: true
        show_state: false
        aspect_ratio: '16:9'
        card_mod:
          style: |
            ha-card {
              border-radius: 8px;
              overflow: hidden;
              border: 1px solid #2A2A2A;
            }

      - type: picture-entity
        entity: camera.tapo_c310_exterior_live_view
        camera_view: live
        show_name: true
        show_state: false
        aspect_ratio: '16:9'
        card_mod:
          style: |
            ha-card {
              border-radius: 8px;
              overflow: hidden;
              border: 1px solid #2A2A2A;
            }

      - type: markdown
        content: |
          # Escenas y Control
        view_layout:
          grid-column: 1 / -1
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-bottom: -12px;
              margin-top: 24px;
            }
            h1 {
              font-size: 18px;
              font-weight: 400;
              margin: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }
      - type: custom:auto-entities
        card:
          type: custom:layout-card
          layout_type: grid
          layout:
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr))
            grid-gap: 16px
        filter:
          include:
            - domain: scene
              options:
                type: custom:button-card
                tap_action:
                  action: call-service
                  service: scene.turn_on
                  service_data:
                    entity_id: this.entity_id
                styles:
                  card:
                    - height: 100px
                    - background: |
                        [[[
                          // Asignar colores segÃºn el icono o nombre
                          const icon = entity.attributes.icon || '';
                          const name = entity.attributes.friendly_name || '';

                          if (icon.includes('sunset-up') || name.toLowerCase().includes('amanecer')) {
                            return 'linear-gradient(135deg, #F59E0B 0%, #FDB813 100%)';
                          } else if (icon.includes('sunset-down') || icon.includes('night') || name.toLowerCase().includes('anoch')) {
                            return 'linear-gradient(135deg, #4F46E5 0%, #6366F1 100%)';
                          } else if (icon.includes('bed') || name.toLowerCase().includes('dormir')) {
                            return 'linear-gradient(135deg, #9333EA 0%, #A855F7 100%)';
                          } else {
                            return 'linear-gradient(135deg, #10B981 0%, #34D399 100%)';
                          }
                        ]]]
                    - border: none
                    - border-radius: 12px
                    - box-shadow: |
                        [[[
                          const icon = entity.attributes.icon || '';
                          const name = entity.attributes.friendly_name || '';

                          if (icon.includes('sunset-up') || name.toLowerCase().includes('amanecer')) {
                            return '0 4px 12px rgba(245, 158, 11, 0.3)';
                          } else if (icon.includes('sunset-down') || icon.includes('night') || name.toLowerCase().includes('anoch')) {
                            return '0 4px 12px rgba(79, 70, 229, 0.3)';
                          } else if (icon.includes('bed') || name.toLowerCase().includes('dormir')) {
                            return '0 4px 12px rgba(147, 51, 234, 0.3)';
                          } else {
                            return '0 4px 12px rgba(16, 185, 129, 0.3)';
                          }
                        ]]]
                  icon:
                    - width: 40px
                    - color: white
                  name:
                    - font-size: 14px
                    - font-weight: 500
                    - color: white
                card_mod:
                  style: |
                    ha-card:hover {
                      transform: translateY(-2px);
                      transition: all 0.3s ease;
                    }
        sort:
          method: friendly_name
        show_empty: false
      - type: custom:button-card
        entity: input_boolean.presence_simulation
        name: |
          [[[
            return entity.state === 'on' ? 'Detener SimulaciÃ³n' : 'Iniciar SimulaciÃ³n';
          ]]]
        icon: mdi:home-automation
        tap_action:
          action: toggle
        state:
          - value: 'on'
            styles:
              card:
                - height: 100px
                - background: linear-gradient(135deg,
                - border: 2px solid
                - box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4)
              icon:
                - width: 40px
                - color: white
                - animation: pulse 2s ease-in-out infinite
              name:
                - font-size: 14px
                - font-weight: 600
                - color: white
          - value: 'off'
            styles:
              card:
                - height: 100px
                - background: linear-gradient(135deg,
                - border: 2px solid
                - box-shadow: 0 4px 12px rgba(5, 150, 105, 0.4)
              icon:
                - width: 40px
                - color: white
              name:
                - font-size: 14px
                - font-weight: 600
                - color: white
        card_mod:
          style: |
            @keyframes pulse {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.7; }
            }
            ha-card:hover {
              transform: translateY(-2px);
              transition: all 0.3s ease;
            }
      - type: markdown
        content: |
          # Ãreas
        view_layout:
          grid-column: 1 / -1
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-bottom: -12px;
              margin-top: 24px;
            }
            h1 {
              font-size: 18px;
              font-weight: 400;
              margin: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }
      - type: custom:button-card
        name: Ver Todas las Ãreas  â†’
        icon: mdi:home-city-outline
        tap_action:
          action: navigate
          navigation_path: /dashboard-areas/0
        styles:
          card:
            - height: 60px
            - background: 'linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%)'
            - border: none
            - border-radius: 12px
            - box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3)
            - cursor: pointer
          icon:
            - width: 28px
            - height: 28px
            - color: white
          name:
            - font-size: 14px
            - font-weight: 500
            - color: white
            - letter-spacing: 0.5px
        card_mod:
          style: |
            ha-card:hover {
              background: linear-gradient(135deg, #2563EB 0%, #60A5FA 100%) !important;
              transform: translateY(-2px);
              box-shadow: 0 6px 16px rgba(30, 64, 175, 0.4) !important;
              transition: all 0.3s ease;
            }
  - title: Riego
    path: riego
    icon: mdi:sprinkler-variant
    theme: maui_dark
    badges: []
    cards:
      - type: vertical-stack
        cards:
          - type: glance
            title: ğŸš° Sistema de Riego - Zona 1
            show_name: true
            show_state: true
            columns: 3
            entities:
              - entity: sensor.riego_z1_humedad_suelo_z1
                name: Humedad
              - entity: sensor.riego_z1_nivel_tanque
                name: Tanque
              - entity: sensor.riego_z1_luz_ambiente
                name: Luz
          - type: markdown
            content: >
              {% set humedad = states('sensor.riego_z1_humedad_suelo_z1') |
              float(0) %} {% set tanque = states('sensor.riego_z1_nivel_tanque')
              | float(0) %} {% set bomba_a =
              is_state('switch.riego_z1_bomba_z1a', 'on') %} {% set bomba_b =
              is_state('switch.riego_z1_bomba_z1b', 'on') %}

              {% if bomba_a or bomba_b %}
                ### ğŸ’§ **Regando Ahora**
                - Humedad actual: **{{ humedad }}%**
                - Nivel tanque: **{{ tanque }}%**
              {% elif tanque < 20 %}
                ### âš ï¸ **Tanque Bajo**
                - Tanque: **{{ tanque }}%**
                - Sistema detenido hasta rellenar
              {% elif humedad < 30 %}
                ### ğŸŒµ **Suelo Seco**
                - Humedad: **{{ humedad }}%**
                - Esperando horario de riego
              {% else %}
                ### âœ… **Sistema OK**
                - Humedad: **{{ humedad }}%**
                - Tanque: **{{ tanque }}%**
                - Sistema automÃ¡tico activo
              {% endif %}
          - type: history-graph
            title: ğŸ“Š Humedad del Suelo (24h)
            hours_to_show: 24
            refresh_interval: 60
            entities:
              - entity: sensor.riego_z1_humedad_suelo_z1
                name: Humedad Suelo
          - type: entities
            title: ğŸ’§ Control de Bombas
            show_header_toggle: false
            entities:
              - entity: switch.riego_z1_bomba_z1a
                name: Bomba Z1A
                icon: mdi:water-pump
                secondary_info: last-changed
              - entity: switch.riego_z1_bomba_z1b
                name: Bomba Z1B
                icon: mdi:water-pump
                secondary_info: last-changed
              - type: divider
              - entity: light.riego_z1_led_bomba_activa
                name: LED Indicador
                icon: mdi:led-on
          - type: entities
            title: ğŸŒ¡ï¸ Sensores Ambientales
            show_header_toggle: false
            entities:
              - entity: sensor.riego_z1_temperatura_ambiente
                name: Temperatura
                icon: mdi:thermometer
              - entity: sensor.riego_z1_humedad_ambiente
                name: Humedad Ambiente
                icon: mdi:water-percent
              - entity: sensor.riego_z1_luz_ambiente
                name: Luz Ambiente
                icon: mdi:weather-sunny
              - entity: binary_sensor.riego_z1_presencia_detectada
                name: Presencia (LD2410C)
                icon: mdi:motion-sensor
          - type: entities
            title: ğŸ’¡ Indicadores LED
            show_header_toggle: false
            entities:
              - entity: light.riego_z1_led_tanque_lleno
                name: LED Tanque Lleno
                icon: mdi:water-check
              - entity: light.riego_z1_led_tanque_medio
                name: LED Tanque Medio
                icon: mdi:water-minus
              - entity: light.riego_z1_led_tanque_bajo
                name: LED Tanque Bajo
                icon: mdi:water-alert
              - entity: light.riego_z1_led_wifi
                name: LED WiFi
                icon: mdi:wifi
          - type: entities
            title: âš™ï¸ Control Manual
            show_header_toggle: false
            entities:
              - entity: input_boolean.riego_z1_manual
                name: Modo Manual
                icon: mdi:hand-back-right
              - type: divider
              - type: button
                name: ğŸš° Regar 5 minutos
                icon: mdi:timer-10
                tap_action:
                  action: call-service
                  service: script.riego_manual_5min
              - type: button
                name: ğŸš° Regar 10 minutos
                icon: mdi:timer-outline
                tap_action:
                  action: call-service
                  service: script.riego_manual_10min
              - type: button
                name: â›” Detener Todo
                icon: mdi:stop
                tap_action:
                  action: call-service
                  service: script.detener_todas_bombas
              - type: divider
              - entity: automation.riego_automatico_zona_1
                name: AutomatizaciÃ³n
                icon: mdi:robot
          - type: gauge
            entity: sensor.riego_z1_humedad_suelo_z1
            name: Humedad del Suelo
            min: 0
            max: 100
            needle: true
            severity:
              green: 60
              yellow: 40
              red: 0
          - type: gauge
            entity: sensor.riego_z1_nivel_tanque
            name: Nivel del Tanque
            min: 0
            max: 100
            needle: true
            severity:
              green: 50
              yellow: 30
              red: 0
      - type: markdown
        content: |
          # ğŸ“¡ InformaciÃ³n del Sistema
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-top: 24px;
              margin-bottom: -12px;
            }
            h1 {
              font-size: 18px;
              font-weight: 400;
              margin: 0;
              padding: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }
      - type: entities
        title: ESP32 - Riego Z1
        show_header_toggle: false
        entities:
          - entity: binary_sensor.riego_z1_estado_conexion
            name: Estado ConexiÃ³n
            icon: mdi:wifi
          - entity: sensor.riego_z1_wifi_signal
            name: SeÃ±al WiFi
            icon: mdi:wifi-strength-4
          - entity: button.riego_z1_reiniciar_esp32
            name: Reiniciar ESP32
            icon: mdi:restart
        card_mod:
          style: |
            ha-card {
              background: #1A1A1A;
              border: 1px solid #2A2A2A;
              border-radius: 12px;
              box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            }

  - title: SimulaciÃ³n
    path: simulacion
    icon: mdi:home-automation
    theme: maui_dark
    type: custom:grid-layout
    layout:
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr))
      grid-gap: 16px
    badges: []
    cards:
      - type: markdown
        content: |
          # ğŸ  SimulaciÃ³n de Presencia v2.2
        view_layout:
          grid-column: 1 / -1
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-bottom: -12px;
            }
            h1 {
              font-size: 20px;
              font-weight: 500;
              margin: 0;
              padding: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # CONTROL PRINCIPAL - Barra de Estado + Switch + Botones
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - type: vertical-stack
        view_layout:
          grid-column: 1 / -1
        cards:
          # Barra de Estado con Switch tipo iOS
          - type: custom:button-card
            entity: input_boolean.presence_simulation_running
            name: |
              [[[
                if (entity.state === 'on') {
                  const pausado = states['input_boolean.presence_simulation_paused']?.state === 'on';
                  if (pausado) {
                    const lights = parseInt(states['input_number.presence_simulation_lights_on_count']?.state) || 0;
                    return `â¸ï¸ SIMULACIÃ“N EN PAUSA | ${lights} luces encendidas`;
                  }
                  const lights = parseInt(states['input_number.presence_simulation_lights_on_count']?.state) || 0;
                  const loop = parseInt(states['input_number.presence_simulation_loop_counter']?.state) || 0;
                  return `ğŸ”„ SIMULACIÃ“N ACTIVA | ${lights} luces | Loop ${loop}`;
                } else if (states['input_boolean.presence_simulation']?.state === 'off') {
                  return 'âš« SIMULACIÃ“N INACTIVA';
                } else {
                  return 'â³ DETENIENDO...';
                }
              ]]]
            show_state: false
            show_icon: false
            tap_action:
              action: none
            custom_fields:
              switch: |
                [[[
                  const isOn = states['input_boolean.presence_simulation']?.state === 'on';
                  return `
                    <ha-switch
                      ${isOn ? 'checked' : ''}
                      style="
                        --switch-checked-button-color: #10B981;
                        --switch-checked-track-color: rgba(16, 185, 129, 0.5);
                        --switch-unchecked-button-color: #666666;
                        --switch-unchecked-track-color: rgba(100, 100, 100, 0.3);
                        transform: scale(0.8);
                      "
                    ></ha-switch>
                  `;
                ]]]
            styles:
              card:
                - height: 48px
                - border-radius: 12px
                - font-size: 13px
                - font-weight: 600
                - letter-spacing: 0.5px
                - border: none
                - padding: 0 16px
                - display: grid
                - grid-template-columns: 1fr auto
                - align-items: center
                - gap: 16px
              name:
                - justify-self: start
                - text-align: left
                - padding: 0
                - margin: 0
              custom_fields:
                switch:
                  - justify-self: end
                  - align-self: center
            state:
              - value: 'on'
                styles:
                  card:
                    - background: |
                        [[[
                          const pausado = states['input_boolean.presence_simulation_paused']?.state === 'on';
                          if (pausado) {
                            return 'linear-gradient(90deg, rgba(245, 158, 11, 0.15) 0%, rgba(251, 146, 60, 0.25) 100%)';
                          }
                          return 'linear-gradient(90deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.25) 100%)';
                        ]]]
                    - animation: |
                        [[[
                          const pausado = states['input_boolean.presence_simulation_paused']?.state === 'on';
                          return pausado ? 'none' : 'glow-green 2s ease-in-out infinite';
                        ]]]
                    - border: |
                        [[[
                          const pausado = states['input_boolean.presence_simulation_paused']?.state === 'on';
                          return pausado ? '2px solid rgba(245, 158, 11, 0.5)' : '2px solid rgba(16, 185, 129, 0.5)';
                        ]]]
                  name:
                    - color: |
                        [[[
                          const pausado = states['input_boolean.presence_simulation_paused']?.state === 'on';
                          return pausado ? '#F59E0B' : '#10B981';
                        ]]]
              - value: 'off'
                styles:
                  card:
                    - background: 'rgba(50, 50, 50, 0.3)'
                    - border: '1px solid #2A2A2A'
                  name:
                    - color: '#666666'
            card_mod:
              style: |
                @keyframes glow-green {
                  0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
                  50% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); }
                }
                ha-switch {
                  cursor: pointer;
                }
            hold_action:
              action: call-service
              service: input_boolean.toggle
              service_data:
                entity_id: input_boolean.presence_simulation

          # Botones de Control START/PAUSE/RESUME/STOP
          - type: horizontal-stack
            cards:
              # BotÃ³n 1: INICIAR (solo cuando OFF)
              - type: conditional
                conditions:
                  - entity: input_boolean.presence_simulation
                    state: "off"
                card:
                  type: custom:button-card
                  name: INICIAR
                  icon: mdi:play
                  tap_action:
                    action: call-service
                    service: input_boolean.turn_on
                    service_data:
                      entity_id: input_boolean.presence_simulation
                  styles:
                    card:
                      - height: 60px
                      - border-radius: 8px
                      - background: 'linear-gradient(135deg, #10B981 0%, #059669 100%)'
                      - border: none
                      - box-shadow: '0 4px 12px rgba(16, 185, 129, 0.4)'
                    icon:
                      - width: 24px
                      - color: white
                    name:
                      - font-size: 13px
                      - font-weight: 600
                      - color: white
                  card_mod:
                    style: |
                      ha-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 16px rgba(16, 185, 129, 0.5) !important;
                        transition: all 0.3s ease;
                      }

              # BotÃ³n 2: PAUSAR (solo cuando ON y NO pausado)
              - type: conditional
                conditions:
                  - entity: input_boolean.presence_simulation_running
                    state: "on"
                  - entity: input_boolean.presence_simulation_paused
                    state: "off"
                card:
                  type: custom:button-card
                  name: PAUSAR
                  icon: mdi:pause
                  tap_action:
                    action: call-service
                    service: input_boolean.turn_on
                    service_data:
                      entity_id: input_boolean.presence_simulation_paused
                  styles:
                    card:
                      - height: 60px
                      - border-radius: 8px
                      - background: 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)'
                      - border: none
                      - box-shadow: '0 4px 12px rgba(245, 158, 11, 0.4)'
                    icon:
                      - width: 24px
                      - color: white
                    name:
                      - font-size: 13px
                      - font-weight: 600
                      - color: white
                  card_mod:
                    style: |
                      ha-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 16px rgba(245, 158, 11, 0.5) !important;
                        transition: all 0.3s ease;
                      }

              # BotÃ³n 2B: REANUDAR (solo cuando pausado)
              - type: conditional
                conditions:
                  - entity: input_boolean.presence_simulation_paused
                    state: "on"
                card:
                  type: custom:button-card
                  name: REANUDAR
                  icon: mdi:play-circle
                  tap_action:
                    action: call-service
                    service: input_boolean.turn_off
                    service_data:
                      entity_id: input_boolean.presence_simulation_paused
                  styles:
                    card:
                      - height: 60px
                      - border-radius: 8px
                      - background: 'linear-gradient(135deg, #10B981 0%, #059669 100%)'
                      - border: none
                      - box-shadow: '0 4px 12px rgba(16, 185, 129, 0.4)'
                    icon:
                      - width: 24px
                      - color: white
                    name:
                      - font-size: 13px
                      - font-weight: 600
                      - color: white
                  card_mod:
                    style: |
                      ha-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 16px rgba(16, 185, 129, 0.5) !important;
                        transition: all 0.3s ease;
                      }

              # BotÃ³n 3: DETENER (cuando estÃ¡ ON)
              - type: conditional
                conditions:
                  - entity: input_boolean.presence_simulation
                    state: "on"
                card:
                  type: custom:button-card
                  name: DETENER
                  icon: mdi:stop
                  tap_action:
                    action: call-service
                    service: input_boolean.turn_off
                    service_data:
                      entity_id: input_boolean.presence_simulation
                  confirmation:
                    text: "Â¿Detener la simulaciÃ³n y apagar todas las luces?"
                  styles:
                    card:
                      - height: 60px
                      - border-radius: 8px
                      - background: 'linear-gradient(135deg, #DC2626 0%, #B91C1C 100%)'
                      - border: none
                      - box-shadow: '0 4px 12px rgba(220, 38, 38, 0.4)'
                    icon:
                      - width: 24px
                      - color: white
                      - animation: pulse 2s ease-in-out infinite
                    name:
                      - font-size: 13px
                      - font-weight: 600
                      - color: white
                  card_mod:
                    style: |
                      @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.8; }
                      }
                      ha-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 16px rgba(220, 38, 38, 0.6) !important;
                        transition: all 0.3s ease;
                      }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ESTADO Y PROGRESO
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - type: horizontal-stack
        cards:
          - type: entities
            title: â±ï¸ Progreso
            show_header_toggle: false
            entities:
              - entity: sensor.presence_simulation_runtime
                name: Tiempo Activo
                icon: mdi:timer-outline
              - entity: sensor.presence_simulation_progress
                name: Progreso
                icon: mdi:progress-clock
              - entity: sensor.presence_simulation_time_remaining
                name: Tiempo Restante
                icon: mdi:timer-sand
            card_mod:
              style: |
                ha-card {
                  background: #1A1A1A;
                  border: 1px solid #2A2A2A;
                  border-radius: 12px;
                }
                .card-header {
                  background: linear-gradient(90deg, rgba(255, 152, 0, 0.15) 0%, transparent 100%);
                  border-left: 4px solid #FF9800;
                  padding: 12px 16px;
                  font-size: 14px;
                  font-weight: 600;
                  color: #FF9800;
                }

          - type: entities
            title: ğŸ“Š Loops
            show_header_toggle: false
            entities:
              - entity: input_number.presence_simulation_loop_counter
                name: Loop Actual
                icon: mdi:counter
              - entity: input_number.presence_simulation_loop_total
                name: Total de Loops
                icon: mdi:format-list-numbered
              - entity: input_text.presence_simulation_status
                name: Estado
                icon: mdi:information-outline
            card_mod:
              style: |
                ha-card {
                  background: #1A1A1A;
                  border: 1px solid #2A2A2A;
                  border-radius: 12px;
                }
                .card-header {
                  background: linear-gradient(90deg, rgba(66, 165, 245, 0.15) 0%, transparent 100%);
                  border-left: 4px solid #42A5F5;
                  padding: 12px 16px;
                  font-size: 14px;
                  font-weight: 600;
                  color: #42A5F5;
                }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # LUCES ACTIVAS
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - type: entities
        title: ğŸ’¡ Luces Activas
        show_header_toggle: false
        entities:
          - entity: input_number.presence_simulation_lights_on_count
            name: Cantidad Encendidas
            icon: mdi:lightbulb-multiple
          - entity: input_text.presence_simulation_active_lights
            name: Dispositivos
            icon: mdi:format-list-bulleted
          - entity: input_text.presence_simulation_last_light_on
            name: Ãšltima Encendida
            icon: mdi:lightbulb-on
          - entity: input_text.presence_simulation_last_light_off
            name: Ãšltima Apagada
            icon: mdi:lightbulb-off
        card_mod:
          style: |
            ha-card {
              background: #1A1A1A;
              border: 1px solid #2A2A2A;
              border-radius: 12px;
            }
            .card-header {
              background: linear-gradient(90deg, rgba(76, 175, 80, 0.15) 0%, transparent 100%);
              border-left: 4px solid #4CAF50;
              padding: 12px 16px;
              font-size: 14px;
              font-weight: 600;
              color: #4CAF50;
            }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # HISTORIAL 24H
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - type: history-graph
        title: ğŸ“ˆ Historial 24 horas
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: input_boolean.presence_simulation_running
            name: EjecuciÃ³n
          - entity: input_number.presence_simulation_lights_on_count
            name: Luces Encendidas
        card_mod:
          style: |
            ha-card {
              background: #1A1A1A;
              border: 1px solid #2A2A2A;
              border-radius: 12px;
            }
            .card-header {
              background: linear-gradient(90deg, rgba(139, 92, 246, 0.15) 0%, transparent 100%);
              border-left: 4px solid #8B5CF6;
              padding: 12px 16px;
              font-size: 14px;
              font-weight: 600;
              color: #8B5CF6;
            }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # CONFIGURACIÃ“N ACTUAL (Markdown DinÃ¡mico)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - type: markdown
        title: âš™ï¸ ConfiguraciÃ³n Actual
        content: |
          **Blueprint:** Presence Simulation v2.2

          ---

          ### ğŸ“Š Estado de EjecuciÃ³n

          **Estado:** {{ states('input_text.presence_simulation_status') }}
          **Pausado:** {{ 'â¸ï¸ SÃ­' if is_state('input_boolean.presence_simulation_paused', 'on') else 'â–¶ï¸ No' }}
          **Ejecutando:** {{ 'ğŸŸ¢ Activo' if is_state('input_boolean.presence_simulation_running', 'on') else 'âš« Inactivo' }}

          ---

          ### â±ï¸ Timing de EjecuciÃ³n

          **Fecha inicio:** {{ states('input_datetime.presence_simulation_start_time') }}
          **Tiempo activo:** {{ states('sensor.presence_simulation_runtime') }}
          **Tiempo restante:** {{ states('sensor.presence_simulation_time_remaining') }}

          ---

          ### âš™ï¸ ParÃ¡metros de AutomatizaciÃ³n

          > âš ï¸ **Nota:** Los parÃ¡metros de configuraciÃ³n se gestionan directamente desde la automatizaciÃ³n en *Ajustes > Automatizaciones*.

          **Resumen de funcionamiento:**
          1. **RotaciÃ³n:** Enciende luces secuencialmente.
          2. **Espera:** Mantiene las luces encendidas.
          3. **Reinicio:** Apaga y comienza nuevo ciclo.


          ---

          ### ğŸ“– Flujo de EjecuciÃ³n

          1. **RotaciÃ³n** â†’ Enciende/apaga luces cada 5-10 seg
          2. **Mantener** â†’ Ãšltimas 2 encendidas por 2-3 min
          3. **Apagar** â†’ Todas las luces se apagan
          4. **Pausa** â†’ Espera 1-2 min entre loops
          5. **Repetir** â†’ Vuelve al paso 1 (con orden aleatorio)

          ---

          ### ğŸ”„ Progreso

          **Loop actual:** {{ states('input_number.presence_simulation_loop_counter') | int(0) }}
          **Total loops:** {{ states('input_number.presence_simulation_loop_total') | int(0) }}
          **Progreso:** {{ states('sensor.presence_simulation_progress') | int(0) }}%

          ---

          ### ğŸ’¡ Luces

          **Luces encendidas:** {{ states('input_number.presence_simulation_lights_on_count') | int(0) }}
          **Ãšltima encendida:** {{ states('input_text.presence_simulation_last_light_on') }}
          **Ãšltima apagada:** {{ states('input_text.presence_simulation_last_light_off') }}
        card_mod:
          style: |
            ha-card {
              background: #1A1A1A;
              border: 1px solid #2A2A2A;
              border-radius: 12px;
              padding: 16px;
            }
            .card-header {
              background: linear-gradient(90deg, rgba(236, 72, 153, 0.15) 0%, transparent 100%);
              border-left: 4px solid #EC4899;
              padding: 12px 16px;
              font-size: 14px;
              font-weight: 600;
              color: #EC4899;
              margin: -16px -16px 16px -16px;
            }
            ha-markdown {
              color: #A0A0A0;
              font-size: 13px;
              line-height: 1.8;
            }
            ha-markdown strong {
              color: #E0E0E0;
            }

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ACCIONES RÃPIDAS
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      - type: horizontal-stack
        cards:
          - type: custom:button-card
            name: ğŸ”„ Reset Completo
            icon: mdi:refresh
            tap_action:
              action: call-service
              service: script.reset_presence_simulation
            confirmation:
              text: "Â¿Resetear todos los valores de la simulaciÃ³n?"
            styles:
              card:
                - height: 60px
                - background: 'linear-gradient(135deg, #EF4444 0%, #DC2626 100%)'
                - border: none
                - border-radius: 12px
                - box-shadow: '0 4px 12px rgba(239, 68, 68, 0.3)'
              icon:
                - width: 24px
                - color: white
              name:
                - font-size: 13px
                - font-weight: 500
                - color: white
            card_mod:
              style: |
                ha-card:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4) !important;
                  transition: all 0.3s ease;
                }

          - type: custom:button-card
            name: Ver DocumentaciÃ³n
            icon: mdi:book-open-variant
            tap_action:
              action: url
              url_path: https://github.com/mauitz/home-assistant-blueprints
            styles:
              card:
                - height: 60px
                - background: 'linear-gradient(135deg, #6366F1 0%, #4F46E5 100%)'
                - border: none
                - border-radius: 12px
                - box-shadow: '0 4px 12px rgba(99, 102, 241, 0.3)'
              icon:
                - width: 24px
                - color: white
              name:
                - font-size: 13px
                - font-weight: 500
                - color: white
            card_mod:
              style: |
                ha-card:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4) !important;
                  transition: all 0.3s ease;
                }

          - type: custom:button-card
            name: Ver Logbook
            icon: mdi:text-box-outline
            tap_action:
              action: navigate
              navigation_path: /logbook
            styles:
              card:
                - height: 60px
                - background: 'linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)'
                - border: none
                - border-radius: 12px
                - box-shadow: '0 4px 12px rgba(139, 92, 246, 0.3)'
              icon:
                - width: 24px
                - color: white
              name:
                - font-size: 13px
                - font-weight: 500
                - color: white
            card_mod:
              style: |
                ha-card:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4) !important;
                  transition: all 0.3s ease;
                }

  - title: Plano
    path: floorplan
    icon: mdi:floor-plan
    theme: maui_dark
    badges: []
    cards:
      - type: markdown
        content: |
          # ğŸ  Plano Interactivo de la Casa
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-bottom: -12px;
            }
            h1 {
              font-size: 20px;
              font-weight: 500;
              margin: 0;
              padding: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }

      - type: custom:floorplan-card
        full_height: true
        config:
          image: /local/floorplan/casa.svg
          stylesheet: /local/floorplan/casa.css

          rules:
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # LIVING/COCINA - Control de luces
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            - element: living_cocina
              entity: light.riego_z1_led_wifi
              state_action:
                - service: floorplan.class_toggle
                  service_data:
                    class: light-on
                - service: floorplan.class_toggle
                  service_data:
                    class: light-off
              tap_action:
                action: call-service
                service: light.toggle
                service_data:
                  entity_id: light.riego_z1_led_wifi
              hold_action:
                action: more-info

            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # DECK EXTERIOR - Sensor de riego
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            - element: deck_exterior
              entity: sensor.riego_z1_humedad_suelo_z1
              state_action:
                - service: floorplan.class_toggle
                  service_data:
                    class: sensor-on
              tap_action:
                action: navigate
                navigation_path: /dashboard-maui/riego

            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # ENTRADA - CÃ¡mara
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            - element: entrada
              entity: camera.tapo_c530ws_entrada_live_view
              tap_action:
                action: more-info
              hold_action:
                action: call-service
                service: camera.snapshot
                service_data:
                  entity_id: camera.tapo_c530ws_entrada_live_view

            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # SENSORES - Indicadores visuales
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            - element: sensor_living
              entity: sensor.riego_z1_humedad_suelo_z1
              state_action:
                - service: floorplan.class_toggle
                  service_data:
                    class: sensor-on
              tap_action:
                action: more-info

            - element: sensor_entrada
              entity: camera.tapo_c530ws_entrada_live_view
              state_action:
                - service: floorplan.class_toggle
                  service_data:
                    class: sensor-on
              tap_action:
                action: more-info

            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            # PUERTA PRINCIPAL
            # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            - element: puerta_principal
              entity: binary_sensor.riego_z1_presencia_detectada
              state_action:
                - service: floorplan.class_toggle
                  service_data:
                    class: door-open
                - service: floorplan.class_toggle
                  service_data:
                    class: door-closed
              tap_action:
                action: more-info

      - type: markdown
        content: |
          # ğŸ“Š Estado General
        card_mod:
          style: |
            ha-card {
              background: none;
              box-shadow: none;
              margin-top: 24px;
              margin-bottom: -12px;
            }
            h1 {
              font-size: 18px;
              font-weight: 400;
              margin: 0;
              color: #A0A0A0;
              letter-spacing: 0.5px;
            }

      - type: horizontal-stack
        cards:
          - type: custom:button-card
            entity: sensor.riego_z1_humedad_suelo_z1
            name: Humedad Suelo
            icon: mdi:water-percent
            show_state: true
            styles:
              card:
                - height: 100px
                - background: linear-gradient(135deg, #2196F3 0%, #42A5F5 100%)
                - border: none
                - border-radius: 12px
                - box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3)
              icon:
                - width: 35px
                - color: white
              name:
                - font-size: 13px
                - font-weight: 500
                - color: white
              state:
                - font-size: 18px
                - font-weight: 600
                - color: white
            tap_action:
              action: navigate
              navigation_path: /dashboard-maui/riego

          - type: custom:button-card
            entity: sensor.riego_z1_nivel_tanque
            name: Nivel Tanque
            icon: mdi:water-check
            show_state: true
            styles:
              card:
                - height: 100px
                - background: linear-gradient(135deg, #00BCD4 0%, #26C6DA 100%)
                - border: none
                - border-radius: 12px
                - box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3)
              icon:
                - width: 35px
                - color: white
              name:
                - font-size: 13px
                - font-weight: 500
                - color: white
              state:
                - font-size: 18px
                - font-weight: 600
                - color: white
            tap_action:
              action: navigate
              navigation_path: /dashboard-maui/riego

          - type: custom:button-card
            entity: camera.tapo_c530ws_entrada_live_view
            name: CÃ¡mara Entrada
            icon: mdi:cctv
            styles:
              card:
                - height: 100px
                - background: linear-gradient(135deg, #673AB7 0%, #7E57C2 100%)
                - border: none
                - border-radius: 12px
                - box-shadow: 0 4px 12px rgba(103, 58, 183, 0.3)
              icon:
                - width: 35px
                - color: white
              name:
                - font-size: 13px
                - font-weight: 500
                - color: white
            tap_action:
              action: more-info

      - type: markdown
        content: |
          # â„¹ï¸ Instrucciones

          **InteracciÃ³n con el plano:**
          - ğŸ–±ï¸ **Click**: Alternar luces o abrir detalles
          - ğŸ‘† **Mantener presionado**: MÃ¡s informaciÃ³n
          - ğŸ¨ **Colores**:
            - ğŸŸ¡ Amarillo: Luz encendida
            - ğŸ”´ Rojo: Movimiento detectado
            - ğŸŸ¢ Verde: Sensor activo
            - âšª Gris: Apagado/Inactivo
        card_mod:
          style: |
            ha-card {
              background: #1A1A1A;
              border: 1px solid #2A2A2A;
              border-radius: 12px;
              padding: 16px;
              margin-top: 16px;
            }
            ha-markdown {
              color: #A0A0A0;
              font-size: 13px;
              line-height: 1.6;
            }
            ha-markdown h1 {
              font-size: 16px;
              font-weight: 600;
              color: #42A5F5;
              margin-bottom: 12px;
            }
            ha-markdown strong {
              color: #E0E0E0;
            }