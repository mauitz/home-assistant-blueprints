# ============================================
# WIDGET DE RIEGO ZONA 1 - VERSIÃ“N CORREGIDA
# ============================================
# Widget con nombres de entidades correctos para ESP32
# Prefijo: riego_z1_
# ============================================

type: vertical-stack
cards:
  # ==========================================
  # CABECERA - Estado General
  # ==========================================
  - type: glance
    title: ðŸš° Sistema de Riego - Zona 1
    show_name: true
    show_state: true
    columns: 3
    entities:
      - entity: sensor.riego_z1_humedad_suelo_z1
        name: Humedad
      - entity: sensor.riego_z1_nivel_tanque
        name: Tanque
      - entity: sensor.riego_z1_luz_ambiente
        name: Luz

  # ==========================================
  # ESTADO DEL SISTEMA
  # ==========================================
  - type: markdown
    content: >
      {% set humedad = states('sensor.riego_z1_humedad_suelo_z1') | float(0) %}
      {% set tanque = states('sensor.riego_z1_nivel_tanque') | float(0) %}
      {% set bomba_a = is_state('switch.riego_z1_bomba_z1a', 'on') %}
      {% set bomba_b = is_state('switch.riego_z1_bomba_z1b', 'on') %}
      
      {% if bomba_a or bomba_b %}
        ### ðŸ’§ **Regando Ahora**
        - Humedad actual: **{{ humedad }}%**
        - Nivel tanque: **{{ tanque }}%**
      {% elif tanque < 20 %}
        ### âš ï¸ **Tanque Bajo**
        - Tanque: **{{ tanque }}%**
        - Sistema detenido hasta rellenar
      {% elif humedad < 30 %}
        ### ðŸŒµ **Suelo Seco**
        - Humedad: **{{ humedad }}%**
        - Esperando horario de riego
      {% else %}
        ### âœ… **Sistema OK**
        - Humedad: **{{ humedad }}%**
        - Tanque: **{{ tanque }}%**
        - Sistema automÃ¡tico activo
      {% endif %}

  # ==========================================
  # GRÃFICO DE HUMEDAD
  # ==========================================
  - type: history-graph
    title: ðŸ“Š Humedad del Suelo (24h)
    hours_to_show: 24
    refresh_interval: 60
    entities:
      - entity: sensor.riego_z1_humedad_suelo_z1
        name: Humedad Suelo

  # ==========================================
  # CONTROLES DE BOMBAS
  # ==========================================
  - type: entities
    title: ðŸ’§ Control de Bombas
    show_header_toggle: false
    entities:
      - entity: switch.riego_z1_bomba_z1a
        name: Bomba Z1A
        icon: mdi:water-pump
        secondary_info: last-changed
      
      - entity: switch.riego_z1_bomba_z1b
        name: Bomba Z1B
        icon: mdi:water-pump
        secondary_info: last-changed
      
      - type: divider
      
      - entity: light.riego_z1_led_bomba_activa
        name: LED Indicador
        icon: mdi:led-on

  # ==========================================
  # SENSORES AMBIENTALES
  # ==========================================
  - type: entities
    title: ðŸŒ¡ï¸ Sensores Ambientales
    show_header_toggle: false
    entities:
      - entity: sensor.riego_z1_temperatura_ambiente
        name: Temperatura
        icon: mdi:thermometer
      
      - entity: sensor.riego_z1_humedad_ambiente
        name: Humedad Ambiente
        icon: mdi:water-percent
      
      - entity: sensor.riego_z1_luz_ambiente
        name: Luz Ambiente
        icon: mdi:weather-sunny
      
      - entity: binary_sensor.riego_z1_presencia_detectada
        name: Presencia (LD2410C)
        icon: mdi:motion-sensor

  # ==========================================
  # LEDs DE ESTADO
  # ==========================================
  - type: entities
    title: ðŸ’¡ Indicadores LED
    show_header_toggle: false
    entities:
      - entity: light.riego_z1_led_tanque_lleno
        name: LED Tanque Lleno
        icon: mdi:water-check
      
      - entity: light.riego_z1_led_tanque_medio
        name: LED Tanque Medio
        icon: mdi:water-minus
      
      - entity: light.riego_z1_led_tanque_bajo
        name: LED Tanque Bajo
        icon: mdi:water-alert
      
      - entity: light.riego_z1_led_wifi
        name: LED WiFi
        icon: mdi:wifi

  # ==========================================
  # CONTROL MANUAL Y SCRIPTS
  # ==========================================
  - type: entities
    title: âš™ï¸ Control Manual
    show_header_toggle: false
    entities:
      - entity: input_boolean.riego_z1_manual
        name: Modo Manual
        icon: mdi:hand-back-right
      
      - type: divider
      
      - type: button
        name: ðŸš° Regar 5 minutos
        icon: mdi:timer-10
        tap_action:
          action: call-service
          service: script.riego_manual_5min
      
      - type: button
        name: ðŸš° Regar 10 minutos
        icon: mdi:timer-outline
        tap_action:
          action: call-service
          service: script.riego_manual_10min
      
      - type: button
        name: â›” Detener Todo
        icon: mdi:stop
        tap_action:
          action: call-service
          service: script.detener_todas_bombas
      
      - type: divider
      
      - entity: automation.riego_automatico_zona_1
        name: AutomatizaciÃ³n
        icon: mdi:robot

  # ==========================================
  # INDICADORES GAUGE
  # ==========================================
  - type: gauge
    entity: sensor.riego_z1_humedad_suelo_z1
    name: Humedad del Suelo
    min: 0
    max: 100
    needle: true
    severity:
      green: 60
      yellow: 40
      red: 0

  - type: gauge
    entity: sensor.riego_z1_nivel_tanque
    name: Nivel del Tanque
    min: 0
    max: 100
    needle: true
    severity:
      green: 50
      yellow: 30
      red: 0

