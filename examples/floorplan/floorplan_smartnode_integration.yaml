# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ  FLOORPLAN CON INTEGRACIÃ“N DE SMARTNODES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Este ejemplo muestra cÃ³mo integrar tus SmartNodes en el floorplan
# para visualizar y controlar iluminaciÃ³n basada en presencia
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

type: picture-elements
image: /local/floorplan/casa.png
title: Control Inteligente - SmartNodes

elements:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # DORMITORIO - SmartNode con Presencia
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # Zona interactiva del dormitorio
  - type: custom:button-card
    entity: light.dormitorio_smartnode
    show_icon: false
    show_name: false
    tap_action:
      action: toggle
    hold_action:
      action: more-info
    style:
      top: 30%
      left: 70%
      width: 280px
      height: 240px
      background: |
        {% if is_state('light.dormitorio_smartnode', 'on') %}
          radial-gradient(circle, rgba(255,215,0,0.3) 0%, rgba(255,235,59,0.1) 100%)
        {% elif is_state('binary_sensor.dormitorio_motion', 'on') %}
          radial-gradient(circle, rgba(255,82,82,0.2) 0%, transparent 100%)
        {% else %}
          rgba(0, 0, 0, 0.05)
        {% endif %}
      border: |
        {% if is_state('light.dormitorio_smartnode', 'on') %}
          3px solid rgba(255, 193, 7, 0.8)
        {% elif is_state('binary_sensor.dormitorio_motion', 'on') %}
          2px dashed rgba(255, 82, 82, 0.6)
        {% else %}
          1px solid rgba(0, 0, 0, 0.15)
        {% endif %}
      border-radius: 15px
      transition: all 0.5s ease

  # Icono del SmartNode
  - type: state-icon
    entity: light.dormitorio_smartnode
    icon: mdi:lightbulb-multiple
    tap_action:
      action: toggle
    hold_action:
      action: more-info
    style:
      top: 30%
      left: 70%
      transform: scale(1.5)
      filter: |
        {% if is_state('light.dormitorio_smartnode', 'on') %}
          drop-shadow(0 0 15px rgba(255, 193, 7, 0.8))
        {% else %}
          none
        {% endif %}

  # Etiqueta del SmartNode
  - type: state-label
    entity: light.dormitorio_smartnode
    prefix: "ðŸ’¡ "
    style:
      top: 35%
      left: 70%
      background: |
        {% if is_state('light.dormitorio_smartnode', 'on') %}
          rgba(255, 193, 7, 0.95)
        {% else %}
          rgba(100, 100, 100, 0.7)
        {% endif %}
      color: white
      padding: 6px 14px
      border-radius: 20px
      font-size: 14px
      font-weight: bold
      box-shadow: 0 3px 8px rgba(0,0,0,0.3)
      pointer-events: none

  # Sensor de presencia
  - type: state-icon
    entity: binary_sensor.dormitorio_motion
    icon: mdi:motion-sensor
    style:
      top: 26%
      left: 66%
      transform: scale(1.2)
      color: |
        {% if is_state('binary_sensor.dormitorio_motion', 'on') %}
          #FF5252
        {% else %}
          #9E9E9E
        {% endif %}
      animation: |
        {% if is_state('binary_sensor.dormitorio_motion', 'on') %}
          pulse 1.5s infinite
        {% endif %}

  # Sensor de iluminaciÃ³n
  - type: state-label
    entity: sensor.dormitorio_illuminance
    prefix: "â˜€ï¸ "
    suffix: " lx"
    style:
      top: 40%
      left: 70%
      background: rgba(33, 150, 243, 0.9)
      color: white
      padding: 4px 10px
      border-radius: 12px
      font-size: 12px
      font-weight: bold
      pointer-events: none

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # SALA - SmartNode con Control de Escenas
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # Zona interactiva de la sala
  - type: custom:button-card
    entity: light.sala_smartnode
    show_icon: false
    show_name: false
    tap_action:
      action: toggle
    hold_action:
      action: call-service
      service: scene.turn_on
      service_data:
        entity_id: scene.sala_movie
    style:
      top: 30%
      left: 25%
      width: 320px
      height: 260px
      background: |
        {% if is_state('light.sala_smartnode', 'on') %}
          radial-gradient(circle, rgba(255,215,0,0.3) 0%, rgba(255,235,59,0.1) 100%)
        {% else %}
          rgba(0, 0, 0, 0.05)
        {% endif %}
      border: |
        {% if is_state('light.sala_smartnode', 'on') %}
          3px solid rgba(255, 193, 7, 0.8)
        {% else %}
          1px solid rgba(0, 0, 0, 0.15)
        {% endif %}
      border-radius: 15px

  # Panel de control de escenas
  - type: custom:button-card
    name: Escenas
    icon: mdi:palette
    tap_action:
      action: navigate
      navigation_path: /lovelace/sala-escenas
    style:
      top: 25%
      left: 20%
      background: rgba(103, 58, 183, 0.9)
      border-radius: 10px
      padding: 8px
      box-shadow: 0 3px 8px rgba(0,0,0,0.3)

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PANEL DE ESTADO GLOBAL (esquina superior derecha)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # Contador de luces encendidas
  - type: custom:button-card
    entity: sensor.lights_on_count
    name: Luces Activas
    icon: mdi:lightbulb-on
    show_state: true
    tap_action:
      action: navigate
      navigation_path: /lovelace/luces
    style:
      top: 5%
      right: 5%
      background: |
        {% set count = states('sensor.lights_on_count') | int %}
        {% if count > 0 %}
          rgba(255, 193, 7, 0.95)
        {% else %}
          rgba(100, 100, 100, 0.7)
        {% endif %}
      border-radius: 15px
      padding: 10px 20px
      box-shadow: 0 4px 10px rgba(0,0,0,0.3)

  # Estado de simulaciÃ³n de presencia
  - type: state-icon
    entity: input_boolean.presence_simulation
    icon: mdi:home-account
    tap_action:
      action: toggle
    style:
      top: 5%
      right: 15%
      transform: scale(1.3)
      color: |
        {% if is_state('input_boolean.presence_simulation', 'on') %}
          #4CAF50
        {% else %}
          #9E9E9E
        {% endif %}
      filter: |
        {% if is_state('input_boolean.presence_simulation', 'on') %}
          drop-shadow(0 0 10px rgba(76, 175, 80, 0.8))
        {% endif %}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # INFORMACIÃ“N DE CLIMA Y HORARIO (esquina inferior)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # Amanecer y atardecer
  - type: state-label
    entity: sensor.sun_next_rising
    prefix: "ðŸŒ… "
    style:
      bottom: 5%
      left: 5%
      background: rgba(255, 152, 0, 0.9)
      color: white
      padding: 6px 12px
      border-radius: 15px
      font-size: 12px
      font-weight: bold

  - type: state-label
    entity: sensor.sun_next_setting
    prefix: "ðŸŒ‡ "
    style:
      bottom: 5%
      left: 20%
      background: rgba(156, 39, 176, 0.9)
      color: white
      padding: 6px 12px
      border-radius: 15px
      font-size: 12px
      font-weight: bold

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # BOTONES DE ACCESO RÃPIDO (parte inferior)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  # Apagar todas las luces
  - type: custom:button-card
    name: Apagar Todo
    icon: mdi:lightbulb-off
    tap_action:
      action: call-service
      service: light.turn_off
      service_data:
        entity_id: all
    style:
      bottom: 5%
      right: 5%
      background: rgba(244, 67, 54, 0.9)
      color: white
      border-radius: 12px
      padding: 10px 15px
      box-shadow: 0 3px 8px rgba(0,0,0,0.3)

  # Modo noche
  - type: custom:button-card
    name: Modo Noche
    icon: mdi:weather-night
    tap_action:
      action: call-service
      service: scene.turn_on
      service_data:
        entity_id: scene.night_mode
    style:
      bottom: 5%
      right: 18%
      background: rgba(63, 81, 181, 0.9)
      color: white
      border-radius: 12px
      padding: 10px 15px
      box-shadow: 0 3px 8px rgba(0,0,0,0.3)

  # Modo bienvenida
  - type: custom:button-card
    name: Bienvenida
    icon: mdi:home-import-outline
    tap_action:
      action: call-service
      service: scene.turn_on
      service_data:
        entity_id: scene.welcome_home
    style:
      bottom: 5%
      right: 32%
      background: rgba(76, 175, 80, 0.9)
      color: white
      border-radius: 12px
      padding: 10px 15px
      box-shadow: 0 3px 8px rgba(0,0,0,0.3)

---

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# SENSOR PARA CONTAR LUCES ENCENDIDAS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Agregar en configuration.yaml:

template:
  - sensor:
      - name: "Lights On Count"
        unique_id: lights_on_count
        icon: mdi:lightbulb-on
        state: >
          {% set ns = namespace(count=0) %}
          {% for state in states.light %}
            {% if state.state == 'on' %}
              {% set ns.count = ns.count + 1 %}
            {% endif %}
          {% endfor %}
          {{ ns.count }}
        attributes:
          friendly_name: "Luces Encendidas"
          lights_on: >
            {% set ns = namespace(lights=[]) %}
            {% for state in states.light %}
              {% if state.state == 'on' %}
                {% set ns.lights = ns.lights + [state.name] %}
              {% endif %}
            {% endfor %}
            {{ ns.lights | join(', ') }}



