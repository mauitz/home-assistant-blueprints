alias: Presence Simulation (Optimizada)
description: >
  Versión optimizada aprovechando las nuevas características de PezAustral v1.0
  - Control mejorado de switches simultáneos
  - Loop con repeticiones controladas
  - Escena de salida para apagar todo al terminar
use_blueprint:
  path: pezaustral/pezaustral_presence_simulation.yaml
  input:
    # ========================================
    # CONTROL DE AUTOMATIZACIÓN
    # ========================================
    automation_control_entity:
      - input_boolean.presence_simulation
    
    # ========================================
    # TRIGGERS
    # ========================================
    trigger_type: entity_on
    trigger_entity:
      - input_boolean.presence_simulation
    
    # ========================================
    # SWITCHES - Los 6 de tu configuración
    # ========================================
    lights_on:
      - switch.3gang_switch_switch_1
      - switch.4gang_switch_2_switch_1
      - switch.sonoff_10025ffc47_1
      - switch.4gang_switch_switch_1
      - switch.3gang_switch_switch_2
      - switch.bedroom_3_switch_switch_1
    
    # ========================================
    # OPTIMIZACIONES NUEVAS
    # ========================================
    
    # Solo 2 switches encendidos simultáneamente
    # Ventajas:
    # - Más realista (no todos los switches prendidos)
    # - Menor consumo energético
    # - Simula que alguien se mueve por la casa
    max_lights_on: 2
    
    # Orden aleatorio para mayor naturalidad
    entity_order_on: entities_on_shuffled
    
    # Delays más naturales (5-120 segundos)
    random_on_delay_min: 5
    random_on_delay_max: 120
    
    # ========================================
    # DURACIÓN - Tiempos similares a tu config
    # ========================================
    duration_method: min_max_time
    min_on_time: 8
    max_on_time: 30
    transition_off: 1
    
    # ========================================
    # LOOP - Configuración Recomendada
    # ========================================
    enable_loop: true
    
    # 10 repeticiones (aproximadamente 2-4 horas de simulación)
    # Puedes ajustar según necesites:
    # - 5 repeticiones = ~1-2 horas
    # - 15 repeticiones = ~4-6 horas
    # - 0 = infinito (hasta que desactives presence_simulation)
    loop_count: 10
    
    # Pausa entre ciclos: 3-8 minutos
    loop_delay_min: 3
    loop_delay_max: 8
    
    # ========================================
    # ESCENA DE SALIDA - NUEVO
    # ========================================
    # Al terminar las 10 repeticiones, apaga todos los switches
    # NOTA: Debes crear esta escena primero en Home Assistant
    enable_exit_scene: true
    exit_scene:
      - scene.apagar_todos_los_switches
    
    # ========================================
    # CONFIGURACIÓN BÁSICA
    # ========================================
    brightness: 100
    color_temp: 3000
    transition_on: 1
    
    weekdays:
      - mon
      - tue
      - wed
      - thu
      - fri
      - sat
      - sun
    
    global_conditions: []

# ========================================
# NOTAS DE USO:
# ========================================
# 1. Activa input_boolean.presence_simulation para iniciar
# 2. La simulación durará ~2-4 horas (10 ciclos)
# 3. Nunca más de 2 switches encendidos simultáneamente
# 4. Al terminar, activa la escena de apagado
# 5. Desactiva input_boolean.presence_simulation para detener en cualquier momento

